# تصميم قاعدة بيانات منصة السوق البيطرية

يهدف هذا المستند إلى تقديم تصميم شامل لقاعدة بيانات علائقية (Relational Database) لمنصة سوق بيطرية، مع التركيز على الجداول الرئيسية، الأعمدة، أنواع البيانات، القيود، والعلاقات بين الجداول. تم إجراء تحليل دقيق للمتطلبات لضمان تصميم قوي ومرن يلبي احتياجات المنصة.

## 1. تحليل المتطلبات وتحديد الكيانات والعلاقات

بناءً على المتطلبات المقدمة، تم تحديد الكيانات الرئيسية التالية والعلاقات المحتملة بينها:

### أ. الكيانات الأساسية:

*   **المستخدمون (Users):** يمثلون جميع الأفراد الذين يتفاعلون مع المنصة (المشترون، البائعون، المسؤولون). يجب أن يحتوي على معلومات أساسية مثل الاسم، البريد الإلكتروني، كلمة المرور، والدور.
*   **الموردون (Vendors):** يمثلون البائعين الذين يقدمون المنتجات. يرتبطون بكيان المستخدمين.
*   **المنتجات (Products):** العناصر التي يتم بيعها على المنصة. ترتبط بالموردين والفئات والعلامات التجارية.
*   **الفئات (Categories):** لتصنيف المنتجات.
*   **العلامات التجارية (Brands):** لتحديد العلامة التجارية لكل منتج.
*   **الطلبات (Orders):** تمثل عمليات الشراء التي يقوم بها المشترون. ترتبط بالمشترين والموردين.
*   **عناصر الطلب (OrderItems):** تفاصيل المنتجات داخل كل طلب.
*   **المدفوعات (Payments):** سجلات المعاملات المالية.
*   **التقييمات (Reviews):** تقييمات المنتجات والموردين من قبل المشترين.
*   **قوائم المفضلة (Wishlists):** قوائم المنتجات المفضلة للمستخدمين.
*   **عناوين الشحن (ShippingAddresses):** عناوين المشترين المستخدمة للشحن.
*   **الإشعارات (Notifications):** سجلات الإشعارات المرسلة للمستخدمين.

### ب. العلاقات الرئيسية (Conceptual Relationships):

*   **User - Vendor:** علاقة واحد لواحد (One-to-One) أو واحد لصفر/واحد (One-to-Zero/One)، حيث يمكن أن يكون المستخدم موردًا أو لا يكون.
*   **Vendor - Product:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمورد الواحد أن يبيع العديد من المنتجات.
*   **Product - Category:** علاقة متعدد لواحد (Many-to-One)، حيث ينتمي المنتج الواحد إلى فئة واحدة (أو متعدد لمتعدد إذا كان المنتج يمكن أن ينتمي لأكثر من فئة، لكن سنبدأ بواحد لمتعدد لتبسيط التصميم).
*   **Product - Brand:** علاقة متعدد لواحد (Many-to-One)، حيث ينتمي المنتج الواحد إلى علامة تجارية واحدة.
*   **User (Buyer) - Order:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمشتري الواحد أن يقوم بالعديد من الطلبات.
*   **Order - OrderItem:** علاقة واحد لمتعدد (One-to-Many)، حيث يحتوي الطلب الواحد على العديد من عناصر الطلب.
*   **OrderItem - Product:** علاقة متعدد لواحد (Many-to-One)، حيث يرتبط عنصر الطلب بمنتج معين.
*   **Order - Payment:** علاقة واحد لواحد (One-to-One) أو واحد لمتعدد (One-to-Many) إذا كان هناك دفعات جزئية أو متعددة لنفس الطلب. سنفترض واحد لواحد للتبسيط في البداية.
*   **User - Review:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمستخدم الواحد أن يكتب العديد من التقييمات.
*   **Product - Review:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمنتج الواحد أن يتلقى العديد من التقييمات.
*   **Vendor - Review:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمورد الواحد أن يتلقى العديد من التقييمات.
*   **User - Wishlist:** علاقة واحد لواحد (One-to-One) أو واحد لمتعدد (One-to-Many) إذا كان يمكن للمستخدم أن يمتلك أكثر من قائمة مفضلة. سنفترض واحد لواحد.
*   **Wishlist - Product:** علاقة متعدد لمتعدد (Many-to-Many)، حيث يمكن لقائمة المفضلة الواحدة أن تحتوي على العديد من المنتجات، والمنتج الواحد يمكن أن يكون في العديد من قوائم المفضلة.
*   **User - ShippingAddress:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمستخدم الواحد أن يمتلك العديد من عناوين الشحن.
*   **Order - ShippingAddress:** علاقة متعدد لواحد (Many-to-One)، حيث يرتبط الطلب الواحد بعنوان شحن معين.
*   **User - Notification:** علاقة واحد لمتعدد (One-to-Many)، حيث يمكن للمستخدم الواحد أن يتلقى العديد من الإشعارات.

هذا التحليل الأولي يضع الأساس لتصميم الجداول والأعمدة والقيود في المرحلة التالية.


## 2. تصميم الجداول والأعمدة والقيود

في هذه المرحلة، سيتم تحديد كل جدول، الأعمدة الخاصة به، أنواع البيانات لكل عمود، والقيود (مثل المفاتيح الأساسية، المفاتيح الأجنبية، عدم السماح بالقيم الفارغة، والقيم الافتراضية).

### أ. جدول `Users` (المستخدمون)

يحتوي على معلومات جميع المستخدمين (المشترين، البائعين، المسؤولين) مع أدوارهم وصلاحياتهم.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للمستخدم                         |
| `Username`         | `NVARCHAR(50)`   | `UNIQUE`, `NOT NULL`                                                | اسم المستخدم الفريد                        |
| `Email`            | `NVARCHAR(100)`  | `UNIQUE`, `NOT NULL`                                                | البريد الإلكتروني للمستخدم (يستخدم لتسجيل الدخول) |
| `PasswordHash`     | `NVARCHAR(256)`  | `NOT NULL`                                                          | تجزئة كلمة المرور (مشفرة)                  |
| `FirstName`        | `NVARCHAR(50)`   | `NOT NULL`                                                          | الاسم الأول للمستخدم                       |
| `LastName`         | `NVARCHAR(50)`   | `NOT NULL`                                                          | الاسم الأخير للمستخدم                      |
| `PhoneNumber`      | `NVARCHAR(20)`   | `NULL`                                                              | رقم الهاتف                                 |
| `Role`             | `NVARCHAR(20)`   | `NOT NULL`, `CHECK ('Buyer', 'Vendor', 'Admin')`                    | دور المستخدم (مشتري، بائع، مسؤول)          |
| `IsActive`         | `BIT`            | `NOT NULL`, `DEFAULT(1)`                                            | حالة تفعيل الحساب                         |
| `CreatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ إنشاء الحساب                         |
| `UpdatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ آخر تحديث للحساب                     |

### ب. جدول `Vendors` (الموردون)

يحتوي على معلومات إضافية خاصة بالموردين.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                        |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :------------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `FOREIGN KEY REFERENCES Users(Id)`                   | معرف المورد (نفس معرف المستخدم المرتبط به)   |
| `CompanyName`      | `NVARCHAR(100)`  | `UNIQUE`, `NOT NULL`                                                | اسم الشركة الموردة                           |
| `Description`      | `NVARCHAR(MAX)`  | `NULL`                                                              | وصف عن الشركة أو المورد                      |
| `Address`          | `NVARCHAR(255)`  | `NULL`                                                              | عنوان الشركة                                 |
| `CommercialRegister` | `NVARCHAR(50)`   | `UNIQUE`, `NULL`                                                    | رقم السجل التجاري (للتوثيق)                  |
| `TaxId`            | `NVARCHAR(50)`   | `UNIQUE`, `NULL`                                                    | الرقم الضريبي (للتوثيق)                      |
| `Rating`           | `DECIMAL(2,1)`   | `NOT NULL`, `DEFAULT(0.0)`, `CHECK (Rating >= 0 AND Rating <= 5)` | متوسط تقييم المورد (من 0 إلى 5)             |
| `TotalReviews`     | `INT`            | `NOT NULL`, `DEFAULT(0)`                                            | إجمالي عدد التقييمات التي تلقاها المورد     |
| `IsApproved`       | `BIT`            | `NOT NULL`, `DEFAULT(0)`                                            | حالة الموافقة على المورد من قبل المسؤولين   |

### ج. جدول `Categories` (الفئات)

لتصنيف المنتجات.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للفئة                            |
| `Name`             | `NVARCHAR(100)`  | `UNIQUE`, `NOT NULL`                                                | اسم الفئة                                 |
| `Description`      | `NVARCHAR(MAX)`  | `NULL`                                                              | وصف الفئة                                 |
| `ParentCategoryId` | `INT`            | `NULL`, `FOREIGN KEY REFERENCES Categories(Id)`                     | معرف الفئة الأم (للفئات الفرعية)           |

### د. جدول `Brands` (العلامات التجارية)

لتحديد العلامات التجارية للمنتجات.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للعلامة التجارية                  |
| `Name`             | `NVARCHAR(100)`  | `UNIQUE`, `NOT NULL`                                                | اسم العلامة التجارية                       |
| `Description`      | `NVARCHAR(MAX)`  | `NULL`                                                              | وصف العلامة التجارية                       |

### هـ. جدول `Products` (المنتجات)

معلومات المنتجات المعروضة للبيع.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للمنتج                           |
| `VendorId`         | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Vendors(Id)`                    | معرف المورد الذي يبيع المنتج               |
| `CategoryId`       | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Categories(Id)`                 | معرف الفئة التي ينتمي إليها المنتج         |
| `BrandId`          | `INT`            | `NULL`, `FOREIGN KEY REFERENCES Brands(Id)`                         | معرف العلامة التجارية للمنتج               |
| `Name`             | `NVARCHAR(255)`  | `NOT NULL`                                                          | اسم المنتج                                 |
| `Description`      | `NVARCHAR(MAX)`  | `NULL`                                                              | وصف تفصيلي للمنتج                         |
| `Price`            | `DECIMAL(18,2)`  | `NOT NULL`, `CHECK (Price >= 0)`                                    | سعر المنتج                                 |
| `StockQuantity`    | `INT`            | `NOT NULL`, `CHECK (StockQuantity >= 0)`                            | الكمية المتوفرة في المخزون                 |
| `SKU`              | `NVARCHAR(50)`   | `UNIQUE`, `NULL`                                                    | رمز تعريف المنتج (Stock Keeping Unit)      |
| `ImageUrl`         | `NVARCHAR(MAX)`  | `NULL`                                                              | رابط صورة المنتج الرئيسية                  |
| `ExpiryDate`       | `DATE`           | `NULL`                                                              | تاريخ انتهاء صلاحية المنتج (إن وجد)        |
| `Weight`           | `DECIMAL(10,2)`  | `NULL`                                                              | وزن المنتج (لأغراض الشحن)                  |
| `Dimensions`       | `NVARCHAR(50)`   | `NULL`                                                              | أبعاد المنتج (لأغراض الشحن)                |
| `IsActive`         | `BIT`            | `NOT NULL`, `DEFAULT(1)`                                            | حالة تفعيل المنتج (معروض للبيع أم لا)     |
| `CreatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ إضافة المنتج                         |
| `UpdatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ آخر تحديث للمنتج                     |

### و. جدول `ProductImages` (صور المنتجات)

لتخزين صور متعددة للمنتج الواحد.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للصورة                           |
| `ProductId`        | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Products(Id)`                   | معرف المنتج المرتبطة به الصورة             |
| `ImageUrl`         | `NVARCHAR(MAX)`  | `NOT NULL`                                                          | رابط الصورة                                |
| `IsMain`           | `BIT`            | `NOT NULL`, `DEFAULT(0)`                                            | هل هي الصورة الرئيسية للمنتج؟              |

### ز. جدول `ShippingAddresses` (عناوين الشحن)

لتخزين عناوين الشحن الخاصة بالمشترين.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد لعنوان الشحن                     |
| `UserId`           | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Users(Id)`                      | معرف المستخدم صاحب العنوان                 |
| `AddressLine1`     | `NVARCHAR(255)`  | `NOT NULL`                                                          | سطر العنوان الأول                          |
| `AddressLine2`     | `NVARCHAR(255)`  | `NULL`                                                              | سطر العنوان الثاني (اختياري)               |
| `City`             | `NVARCHAR(100)`  | `NOT NULL`                                                          | المدينة                                   |
| `State`            | `NVARCHAR(100)`  | `NULL`                                                              | المحافظة/الولاية (إن وجدت)                 |
| `PostalCode`       | `NVARCHAR(20)`   | `NULL`                                                              | الرمز البريدي                              |
| `Country`          | `NVARCHAR(100)`  | `NOT NULL`, `DEFAULT('Egypt')`                                      | الدولة                                    |
| `IsDefault`        | `BIT`            | `NOT NULL`, `DEFAULT(0)`                                            | هل هو العنوان الافتراضي للمستخدم؟           |

### ح. جدول `Orders` (الطلبات)

تفاصيل الطلبات التي يقوم بها المشترون.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للطلب                            |
| `BuyerId`          | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Users(Id)`                      | معرف المشتري الذي قام بالطلب               |
| `ShippingAddressId`| `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES ShippingAddresses(Id)`          | معرف عنوان الشحن للطلب                     |
| `OrderDate`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ ووقت الطلب                           |
| `OrderStatus`      | `NVARCHAR(50)`   | `NOT NULL`, `DEFAULT('Pending')`, `CHECK ('Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled')` | حالة الطلب                                |
| `TotalAmount`      | `DECIMAL(18,2)`  | `NOT NULL`, `CHECK (TotalAmount >= 0)`                              | إجمالي مبلغ الطلب                          |
| `ShippingCost`     | `DECIMAL(18,2)`  | `NOT NULL`, `DEFAULT(0.0)`, `CHECK (ShippingCost >= 0)`             | تكلفة الشحن                                |
| `PaymentStatus`    | `NVARCHAR(50)`   | `NOT NULL`, `DEFAULT('Pending')`, `CHECK ('Pending', 'Paid', 'Failed', 'Refunded')` | حالة الدفع                                 |
| `PaymentMethod`    | `NVARCHAR(50)`   | `NULL`                                                              | طريقة الدفع المستخدمة                      |
| `Notes`            | `NVARCHAR(MAX)`  | `NULL`                                                              | ملاحظات إضافية على الطلب                  |

### ط. جدول `OrderItems` (عناصر الطلب)

تفاصيل المنتجات داخل كل طلب.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد لعنصر الطلب                      |
| `OrderId`          | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Orders(Id)`                     | معرف الطلب الذي ينتمي إليه العنصر          |
| `ProductId`        | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Products(Id)`                   | معرف المنتج المطلوب                        |
| `VendorId`         | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Vendors(Id)`                    | معرف المورد الذي قدم المنتج في هذا الطلب   |
| `Quantity`         | `INT`            | `NOT NULL`, `CHECK (Quantity > 0)`                                  | الكمية المطلوبة من المنتج                  |
| `UnitPrice`        | `DECIMAL(18,2)`  | `NOT NULL`, `CHECK (UnitPrice >= 0)`                                | سعر الوحدة للمنتج وقت الطلب                |
| `TotalPrice`       | `DECIMAL(18,2)`  | `NOT NULL`, `CHECK (TotalPrice >= 0)`                               | إجمالي سعر هذا العنصر (الكمية * سعر الوحدة) |

### ي. جدول `Payments` (المدفوعات)

سجلات المعاملات المالية.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للدفع                            |
| `OrderId`          | `INT`            | `NOT NULL`, `UNIQUE`, `FOREIGN KEY REFERENCES Orders(Id)`           | معرف الطلب المرتبط بالدفع (علاقة 1:1)      |
| `TransactionId`    | `NVARCHAR(255)`  | `UNIQUE`, `NOT NULL`                                                | معرف المعاملة من بوابة الدفع               |
| `PaymentMethod`    | `NVARCHAR(50)`   | `NOT NULL`                                                          | طريقة الدفع (مثل Visa, MasterCard, Fawry)  |
| `Amount`           | `DECIMAL(18,2)`  | `NOT NULL`, `CHECK (Amount >= 0)`                                   | المبلغ المدفوع                             |
| `PaymentDate`      | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ ووقت الدفع                           |
| `PaymentStatus`    | `NVARCHAR(50)`   | `NOT NULL`, `CHECK ('Pending', 'Completed', 'Failed', 'Refunded')` | حالة الدفع                                 |

### ك. جدول `Reviews` (التقييمات)

تقييمات المنتجات والموردين.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للتقييم                          |
| `UserId`           | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Users(Id)`                      | معرف المستخدم الذي كتب التقييم             |
| `ProductId`        | `INT`            | `NULL`, `FOREIGN KEY REFERENCES Products(Id)`                       | معرف المنتج الذي تم تقييمه (إذا كان تقييم منتج) |
| `VendorId`         | `INT`            | `NULL`, `FOREIGN KEY REFERENCES Vendors(Id)`                        | معرف المورد الذي تم تقييمه (إذا كان تقييم مورد) |
| `Rating`           | `INT`            | `NOT NULL`, `CHECK (Rating >= 1 AND Rating <= 5)`                   | التقييم (من 1 إلى 5 نجوم)                  |
| `Comment`          | `NVARCHAR(MAX)`  | `NULL`                                                              | نص التعليق على التقييم                     |
| `ReviewDate`       | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ ووقت التقييم                         |
| `IsApproved`       | `BIT`            | `NOT NULL`, `DEFAULT(0)`                                            | هل تمت الموافقة على التقييم من قبل المسؤول؟ |

### ل. جدول `Wishlists` (قوائم المفضلة)

قوائم المفضلة للمستخدمين.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد لقائمة المفضلة                   |
| `UserId`           | `INT`            | `NOT NULL`, `UNIQUE`, `FOREIGN KEY REFERENCES Users(Id)`            | معرف المستخدم صاحب قائمة المفضلة (علاقة 1:1) |
| `Name`             | `NVARCHAR(100)`  | `NOT NULL`, `DEFAULT('My Wishlist')`                                | اسم قائمة المفضلة                          |
| `CreatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ إنشاء القائمة                        |
| `UpdatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ آخر تحديث للقائمة                     |

### م. جدول `WishlistItems` (عناصر قائمة المفضلة)

المنتجات داخل قوائم المفضلة.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `WishlistId`       | `INT`            | `PRIMARY KEY`, `FOREIGN KEY REFERENCES Wishlists(Id)`               | معرف قائمة المفضلة                         |
| `ProductId`        | `INT`            | `PRIMARY KEY`, `FOREIGN KEY REFERENCES Products(Id)`                | معرف المنتج في القائمة                     |
| `AddedDate`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ إضافة المنتج للقائمة                 |

### ن. جدول `Notifications` (الإشعارات)

سجلات الإشعارات المرسلة للمستخدمين.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد للإشعار                          |
| `UserId`           | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Users(Id)`                      | معرف المستخدم المستلم للإشعار              |
| `Type`             | `NVARCHAR(50)`   | `NOT NULL`, `CHECK ('OrderUpdate', 'ProductUpdate', 'Promotion', 'System')` | نوع الإشعار                                |
| `Message`          | `NVARCHAR(MAX)`  | `NOT NULL`                                                          | نص الإشعار                                 |
| `IsRead`           | `BIT`            | `NOT NULL`, `DEFAULT(0)`                                            | هل تم قراءة الإشعار؟                       |
| `CreatedAt`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ ووقت إنشاء الإشعار                   |

### س. جدول `CartItems` (عناصر سلة التسوق)

لتخزين المنتجات في سلة التسوق للمستخدمين غير المكتملة.

| اسم العمود         | نوع البيانات     | القيود                                                              | الوصف                                      |
| :----------------- | :--------------- | :------------------------------------------------------------------ | :----------------------------------------- |
| `Id`               | `INT`            | `PRIMARY KEY`, `IDENTITY`                                           | معرف فريد لعنصر سلة التسوق                 |
| `UserId`           | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Users(Id)`                      | معرف المستخدم صاحب سلة التسوق              |
| `ProductId`        | `INT`            | `NOT NULL`, `FOREIGN KEY REFERENCES Products(Id)`                   | معرف المنتج في سلة التسوق                  |
| `Quantity`         | `INT`            | `NOT NULL`, `CHECK (Quantity > 0)`                                  | الكمية المطلوبة من المنتج                  |
| `AddedDate`        | `DATETIME2`      | `NOT NULL`, `DEFAULT(GETDATE())`                                    | تاريخ إضافة المنتج إلى السلة               |

**ملاحظات إضافية:**

*   تم استخدام `NVARCHAR` لأنواع النصوص لدعم اللغات المتعددة (مثل العربية).
*   تم استخدام `DATETIME2` لتخزين التواريخ والأوقات بدقة عالية.
*   تم استخدام `DECIMAL(18,2)` للأسعار والمبالغ لضمان الدقة في العمليات المالية.
*   تم إضافة قيود `CHECK` لضمان صحة البيانات في بعض الأعمدة (مثل `Role`, `Rating`, `OrderStatus`).
*   تم إضافة جدول `ProductImages` لدعم صور متعددة للمنتج الواحد، وجدول `WishlistItems` لدعم علاقة Many-to-Many بين `Wishlists` و `Products`، وجدول `CartItems` لإدارة سلة التسوق المؤقتة.

هذا التصميم يغطي الجداول الأساسية المذكورة ويضيف بعض الجداول الضرورية الأخرى لإنشاء منصة سوق إلكترونية متكاملة. في المرحلة التالية، سيتم تحديد العلاقات بشكل أكثر تفصيلاً.


## 3. تحديد العلاقات بين الجداول (Relationships)

توضح هذه العلاقات كيفية ارتباط الجداول ببعضها البعض، مما يضمن تكامل البيانات ويسمح بالاستعلامات المعقدة.

| الجدول الأول       | نوع العلاقة       | الجدول الثاني       | الأعمدة المرتبطة                               | الوصف                                                              |
| :----------------- | :----------------- | :----------------- | :--------------------------------------------- | :----------------------------------------------------------------- |
| `Users`            | `One-to-One`       | `Vendors`          | `Users.Id` = `Vendors.Id`                      | كل مورد هو مستخدم، ولكن ليس كل مستخدم مورد.                      |
| `Users`            | `One-to-Many`      | `ShippingAddresses`| `Users.Id` = `ShippingAddresses.UserId`        | المستخدم الواحد يمكن أن يمتلك عدة عناوين شحن.                      |
| `Users`            | `One-to-Many`      | `Orders`           | `Users.Id` = `Orders.BuyerId`                  | المشتري الواحد يمكن أن يقوم بعدة طلبات.                            |
| `Users`            | `One-to-Many`      | `Reviews`          | `Users.Id` = `Reviews.UserId`                  | المستخدم الواحد يمكن أن يكتب عدة تقييمات.                          |
| `Users`            | `One-to-One`       | `Wishlists`        | `Users.Id` = `Wishlists.UserId`                | المستخدم الواحد يمتلك قائمة مفضلة واحدة.                           |
| `Users`            | `One-to-Many`      | `Notifications`    | `Users.Id` = `Notifications.UserId`            | المستخدم الواحد يمكن أن يتلقى عدة إشعارات.                        |
| `Users`            | `One-to-Many`      | `CartItems`        | `Users.Id` = `CartItems.UserId`                | المستخدم الواحد يمكن أن يمتلك عدة عناصر في سلة التسوق.            |
| `Vendors`          | `One-to-Many`      | `Products`         | `Vendors.Id` = `Products.VendorId`             | المورد الواحد يمكن أن يبيع عدة منتجات.                             |
| `Vendors`          | `One-to-Many`      | `OrderItems`       | `Vendors.Id` = `OrderItems.VendorId`           | المورد الواحد يمكن أن يكون له منتجات في عدة عناصر طلب.            |
| `Vendors`          | `One-to-Many`      | `Reviews`          | `Vendors.Id` = `Reviews.VendorId`              | المورد الواحد يمكن أن يتلقى عدة تقييمات.                          |
| `Categories`       | `One-to-Many`      | `Products`         | `Categories.Id` = `Products.CategoryId`        | الفئة الواحدة يمكن أن تحتوي على عدة منتجات.                        |
| `Categories`       | `Self-Referencing` | `Categories`       | `Categories.Id` = `Categories.ParentCategoryId`  | الفئة يمكن أن تكون فئة أم لفئات فرعية.                             |
| `Brands`           | `One-to-Many`      | `Products`         | `Brands.Id` = `Products.BrandId`               | العلامة التجارية الواحدة يمكن أن ترتبط بعدة منتجات.                |
| `Products`         | `One-to-Many`      | `ProductImages`    | `Products.Id` = `ProductImages.ProductId`      | المنتج الواحد يمكن أن يحتوي على عدة صور.                           |
| `Products`         | `One-to-Many`      | `OrderItems`       | `Products.Id` = `OrderItems.ProductId`         | المنتج الواحد يمكن أن يظهر في عدة عناصر طلب.                      |
| `Products`         | `One-to-Many`      | `Reviews`          | `Products.Id` = `Reviews.ProductId`            | المنتج الواحد يمكن أن يتلقى عدة تقييمات.                          |
| `Products`         | `Many-to-Many`     | `Wishlists`        | عبر جدول `WishlistItems`                       | المنتج الواحد يمكن أن يكون في عدة قوائم مفضلة، والقائمة الواحدة تحتوي على عدة منتجات. |
| `Products`         | `One-to-Many`      | `CartItems`        | `Products.Id` = `CartItems.ProductId`          | المنتج الواحد يمكن أن يكون في عدة سلات تسوق.                      |
| `Orders`           | `One-to-Many`      | `OrderItems`       | `Orders.Id` = `OrderItems.OrderId`             | الطلب الواحد يحتوي على عدة عناصر طلب.                              |
| `Orders`           | `One-to-One`       | `Payments`         | `Orders.Id` = `Payments.OrderId`               | كل طلب له معاملة دفع واحدة (لتبسيط التصميم الأولي).                |
| `Orders`           | `Many-to-One`      | `ShippingAddresses`| `Orders.ShippingAddressId` = `ShippingAddresses.Id` | الطلب الواحد يرتبط بعنوان شحن واحد.                                |
| `Wishlists`        | `One-to-Many`      | `WishlistItems`    | `Wishlists.Id` = `WishlistItems.WishlistId`    | قائمة المفضلة الواحدة تحتوي على عدة عناصر.                         |
| `WishlistItems`    | `Many-to-One`      | `Products`         | `WishlistItems.ProductId` = `Products.Id`      | عنصر قائمة المفضلة يرتبط بمنتج واحد.                               |

**ملاحظات على العلاقات:**

*   تم استخدام المفاتيح الأساسية (Primary Keys) والمفاتيح الأجنبية (Foreign Keys) لفرض هذه العلاقات وضمان تكامل البيانات.
*   العلاقات `One-to-One` تعني أن كل سجل في الجدول الأول يرتبط بسجل واحد فقط في الجدول الثاني (والعكس صحيح).
*   العلاقات `One-to-Many` تعني أن كل سجل في الجدول الأول يمكن أن يرتبط بعدة سجلات في الجدول الثاني، ولكن كل سجل في الجدول الثاني يرتبط بسجل واحد فقط في الجدول الأول.
*   العلاقات `Many-to-Many` يتم تحقيقها عادةً من خلال جدول وسيط (Junction Table) يربط بين الجدولين الأصليين، كما هو الحال مع `Wishlists` و `Products` عبر `WishlistItems`.

هذا القسم يوضح الروابط الهيكلية بين مكونات قاعدة البيانات، مما يضمن تدفق البيانات بشكل منطقي ومتكامل. في المرحلة التالية، سيتم مراجعة التصميم لضمان شموله واكتماله.


## 4. مراجعة التصميم وضمان الشمولية

بعد تحديد الجداول والأعمدة والعلاقات، يتم إجراء مراجعة شاملة للتصميم لضمان شموله، كفاءته، وقابليته للتوسع، مع الأخذ في الاعتبار المتطلبات الحالية والمستقبلية المحتملة.

### أ. التحقق من الشمولية:

*   **تغطية جميع الكيانات المطلوبة:** تم التأكد من أن جميع الكيانات المذكورة في المتطلبات الأولية (Users, Vendors, Products, Categories, Brands, Orders, OrderItems, Payments, Reviews, Wishlists, ShippingAddresses, Notifications) قد تم تمثيلها بجداول مناسبة.
*   **إضافة كيانات داعمة:** تم إضافة جداول ضرورية مثل `ProductImages` لتخزين صور متعددة للمنتج، و`WishlistItems` لمعالجة علاقة Many-to-Many بين المنتجات وقوائم المفضلة، و`CartItems` لإدارة سلة التسوق المؤقتة.
*   **التعامل مع الأدوار المختلفة:** تم دمج أدوار المستخدمين (Buyer, Vendor, Admin) في جدول `Users` مع فصل معلومات الموردين في جدول `Vendors` المرتبط، مما يوفر مرونة في إدارة الأدوار.
*   **تتبع حالة الطلبات والدفعات:** تم تضمين أعمدة لحالة الطلب (`OrderStatus`) وحالة الدفع (`PaymentStatus`) لتمكين تتبع العمليات بشكل كامل.
*   **معلومات المنتج التفصيلية:** تم تضمين تفاصيل مهمة للمنتجات مثل `SKU`, `ExpiryDate`, `Weight`, `Dimensions` لدعم العمليات اللوجستية وإدارة المخزون.

### ب. اعتبارات قابلية التوسع (Scalability):

*   **الفهرسة (Indexing):** يجب التخطيط لإنشاء فهارس مناسبة على الأعمدة التي تستخدم بشكل متكرر في عمليات البحث، التصفية، والربط (مثل المفاتيح الأساسية والأجنبية، `ProductName`, `VendorName`, `Email`) لتحسين أداء الاستعلامات.
*   **التقسيم (Partitioning):** في حال نمو البيانات بشكل كبير جدًا (ملايين الطلبات أو المنتجات)، يمكن التفكير في تقسيم الجداول الكبيرة (مثل `Orders`, `OrderItems`, `Reviews`) لزيادة الأداء وتقليل أوقات الصيانة.
*   **التطبيع (Normalization):** تم تصميم قاعدة البيانات بمستوى جيد من التطبيع (عادةً 3NF) لتقليل تكرار البيانات وضمان اتساقها، مع الأخذ في الاعتبار إمكانية إلغاء التطبيع (Denormalization) لبعض الجداول في المستقبل لتحسين أداء قراءة البيانات إذا لزم الأمر.

### ج. اعتبارات الأمان (Security):

*   **تجزئة كلمات المرور:** تم تحديد `PasswordHash` لتخزين كلمات المرور المجزأة بدلاً من النص الواضح.
*   **التحكم في الوصول:** يجب تطبيق آليات التحكم في الوصول على مستوى قاعدة البيانات (مثل الأدوار والصلاحيات) لضمان أن المستخدمين والتطبيقات يمكنهم الوصول فقط إلى البيانات التي يحتاجونها.
*   **تشفير البيانات:** التفكير في تشفير البيانات الحساسة (مثل معلومات الدفع) سواء في حالة السكون (Data at Rest) أو أثناء النقل (Data in Transit).

### د. اعتبارات إضافية:

*   **التدقيق (Auditing):** قد يكون من المفيد إضافة جداول أو أعمدة للتدقيق (مثل `CreatedBy`, `ModifiedBy`) لتتبع من قام بتعديل السجلات ومتى.
*   **الرسائل والدردشة:** إذا كانت هناك حاجة لميزة الدردشة بين المشترين والبائعين، سيتطلب ذلك جداول إضافية لـ `Messages` و `Conversations`.
*   **إدارة المخزون المتقدمة:** قد تتطلب ميزات إدارة المخزون الأكثر تعقيدًا (مثل تتبع المخزون عبر مستودعات متعددة) جداول إضافية.
*   **العروض والخصومات:** جداول لإدارة العروض الترويجية، الكوبونات، والخصومات.

هذه المراجعة تؤكد أن التصميم الحالي يوفر أساسًا متينًا للمنصة، مع الأخذ في الاعتبار إمكانية التوسع والتطوير المستقبلي. في المرحلة الأخيرة، سيتم تجميع كل هذه التفاصيل في تقرير نهائي.
